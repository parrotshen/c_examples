#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include "bitwise.h"


uint8 g_pattern[43][2][8] = {
    /* [1] offset 0, bits 1 */
    { { 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  0,  1, } },

    /* [2] offset 0, bits 7 */
    { { 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  0,  7, } },

    /* [3] offset 0, bits 8 */
    { { 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  0,  8, } },

    /* [4] offset 0, bits 9 */
    { { 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  0,  9, } },

    /* [5] offset 0, bits 15 */
    { { 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  0, 15, } },

    /* [6] offset 0, bits 20 */
    { { 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  0, 20, } },

    /* [7] offset 1, bits 1 */
    { { 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  1,  1, } },

    /* [8] offset 1, bits 7 */
    { { 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  1,  7, } },

    /* [9] offset 1, bits 8 */
    { { 0x7f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  1,  8, } },

    /* [10] offset 1, bits 9 */
    { { 0x7f, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  1,  9, } },

    /* [11] offset 1, bits 15 */
    { { 0x7f, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  1, 15, } },

    /* [12] offset 1, bits 20 */
    { { 0x7f, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  1, 20, } },

    /* [13] offset 7, bits 1 */
    { { 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  7,  1, } },

    /* [14] offset 7, bits 7 */
    { { 0x01, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  7,  7, } },

    /* [15] offset 7, bits 8 */
    { { 0x01, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  7,  8, } },

    /* [16] offset 7, bits 9 */
    { { 0x01, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  7,  9, } },

    /* [17] offset 7, bits 15 */
    { { 0x01, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  7, 15, } },

    /* [18] offset 7, bits 20 */
    { { 0x01, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x00, 0x00 },
      {  7, 20, } },

    /* [19] offset 8, bits 1 */
    { { 0x00, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  8,  1, } },

    /* [20] offset 8, bits 7 */
    { { 0x00, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  8,  7, } },

    /* [21] offset 8, bits 8 */
    { { 0x00, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  8,  8, } },

    /* [22] offset 8, bits 9 */
    { { 0x00, 0xff, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  8,  9, } },

    /* [23] offset 8, bits 15 */
    { { 0x00, 0xff, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  8, 15, } },

    /* [24] offset 8, bits 20 */
    { { 0x00, 0xff, 0xff, 0xf0, 0x00, 0x00, 0x00, 0x00 },
      {  8, 20, } },

    /* [25] offset 9, bits 1 */
    { { 0x00, 0x40, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  9,  1, } },

    /* [26] offset 9, bits 7 */
    { { 0x00, 0x7f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  9,  7, } },

    /* [27] offset 9, bits 8 */
    { { 0x00, 0x7f, 0x80, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  9,  8, } },

    /* [28] offset 9, bits 9 */
    { { 0x00, 0x7f, 0xc0, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  9,  9, } },

    /* [29] offset 9, bits 15 */
    { { 0x00, 0x7f, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00 },
      {  9, 15, } },

    /* [30] offset 9, bits 20 */
    { { 0x00, 0x7f, 0xff, 0xf8, 0x00, 0x00, 0x00, 0x00 },
      {  9, 20, } },

    /* [31] offset 15, bits 1 */
    { { 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 },
      { 15,  1, } },

    /* [32] offset 15, bits 7 */
    { { 0x00, 0x01, 0xfc, 0x00, 0x00, 0x00, 0x00, 0x00 },
      { 15,  7, } },

    /* [33] offset 15, bits 8 */
    { { 0x00, 0x01, 0xfe, 0x00, 0x00, 0x00, 0x00, 0x00 },
      { 15,  8, } },

    /* [34] offset 15, bits 9 */
    { { 0x00, 0x01, 0xff, 0x00, 0x00, 0x00, 0x00, 0x00 },
      { 15,  9, } },

    /* [35] offset 15, bits 15 */
    { { 0x00, 0x01, 0xff, 0xfc, 0x00, 0x00, 0x00, 0x00 },
      { 15, 15, } },

    /* [36] offset 15, bits 20 */
    { { 0x00, 0x01, 0xff, 0xff, 0xe0, 0x00, 0x00, 0x00 },
      { 15, 20, } },

    /* [37] offset 20, bits 1 */
    { { 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x00, 0x00 },
      { 20,  1, } },

    /* [38] offset 20, bits 7 */
    { { 0x00, 0x00, 0x0f, 0xe0, 0x00, 0x00, 0x00, 0x00 },
      { 20,  7, } },

    /* [39] offset 20, bits 8 */
    { { 0x00, 0x00, 0x0f, 0xf0, 0x00, 0x00, 0x00, 0x00 },
      { 20,  8, } },

    /* [40] offset 20, bits 9 */
    { { 0x00, 0x00, 0x0f, 0xf8, 0x00, 0x00, 0x00, 0x00 },
      { 20,  9, } },

    /* [41] offset 20, bits 15 */
    { { 0x00, 0x00, 0x0f, 0xff, 0xe0, 0x00, 0x00, 0x00 },
      { 20, 15, } },

    /* [42] offset 20, bits 20 */
    { { 0x00, 0x00, 0x0f, 0xff, 0xff, 0x00, 0x00, 0x00 },
      { 20, 20, } },

    /* [43] offset 10, bits 32 */
    { { 0x00, 0x37, 0xab, 0x6f, 0xbb, 0xc0, 0x00, 0x00 },
      { 10, 32, } }
};

uint8 g_buf[256];


int main(int argc, char *argv[])
{
    uint32 value = 0;
    int offset;
    int bits;
    int i;


    if (argc > 2)
    {
        offset = atoi( argv[1] );
        bits = atoi( argv[2] );
        if ((offset + bits) > 256)
        {
            printf("ERR: (offset %d + bits %d) > 256\n\n", offset, bits);
            return -1;
        }

        for (i=0; i<256; i++)
        {
            g_buf[i] = i;
        }

        bit_dump_color(g_buf, 32, offset, bits);
        value = bit_get_uint32(g_buf, offset, bits);
        printf("offset %d, bits %d, value 0x%x\n", offset, bits, value);

        return 0;
    }


#if 0
    /*
     * 1111 1111 1111 1111 1111 1111 1111 1111 1111 1111
     *                             1 1001 0101 1111 110
     *    F    F    F    F    F    F    9    5    F    B
     */
    g_buf[0] = 0xf0;
    g_buf[1] = 0x33;
    g_buf[2] = 0x6c;
    g_buf[3] = 0x95;
    g_buf[4] = 0xe6;
    g_buf[5] = 0xc8;
    g_buf[6] = 0x4a;
    g_buf[7] = 0xf1;
    offset = 23;
    bits = 16;

    bit_dump_color(g_buf, 8, offset, bits);
    bit_dump(g_buf, 8, 1);

    value = bit_get_uint32(g_buf, offset, bits);
    printf("offset %d, bits %d, value 0x%x\n", offset, bits, value);
#else
    for (i=0; i<43; i++)
    {
        value = bit_get_uint32(
                    g_pattern[i][0],
                    g_pattern[i][1][0],
                    g_pattern[i][1][1]
                );
        printf(
            "[%d] offset %d, bits %d, value 0x%x\n",
            (i + 1),
            g_pattern[i][1][0],
            g_pattern[i][1][1],
            value
        );
        bit_dump(g_pattern[i][0], 8, 1);
    }
#endif


    return 0;
}

